<form>
  <label>Key Transactions</label>
  <description>Key Transactions monitored by New Relic</description>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="myTime">
      <label>Time Period</label>
      <default>
        <earliest>-60m@m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="input_name">
      <label>Account</label>
      <choice value="*">All</choice>
      <default>*</default>
      <fieldForLabel>account_id</fieldForLabel>
      <fieldForValue>account_id</fieldForValue>
      <search>
        <query>sourcetype=newrelic_account  |  dedup account_id | table  account_id</query>
      </search>
    </input>
    <input type="dropdown" token="key_txn" searchWhenChanged="true">
      <label>Key Transactions</label>
      <choice value="*">All</choice>
      <fieldForLabel>name</fieldForLabel>
      <fieldForValue>name</fieldForValue>
      <search>
        <query>sourcetype=newrelic_account source="key_transactions.json" account_id="$input_name$" 

| spath input=_raw output=all_apps path=key_transactions{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*
| dedup name
| table name</query>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </search>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <table>
        <title>Key Transactions Overview - Last Reported Values</title>
        <search>
          <query>sourcetype=newrelic_account source="key_transactions.json" account_id="$input_name$" 
 | spath input=_raw output=all_apps path=key_transactions{} | mvexpand all_apps | spath input=all_apps | rename id as transaction_id application_summary.* as app.* end_user_summary.* as eum.* | dedup name | search name="$key_txn$" | table account_id transaction_id name reporting health_status app.apdex_score app.response_time app.throughput app.error_rate eum.apdex_score eum.response_time eum.throughput  last_reported_at</query>
          <earliest></earliest>
          <latest></latest>
        </search>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="reporting">
          <colorPalette type="map">{"true":#65A637,"false":#D3D3D3,"unknown":#555555}</colorPalette>
        </format>
        <format type="color" field="health_status">
          <colorPalette type="map">{"green":#65A637,"red":#D93F3C,"gray":#D3D3D3,"unknown":#555555}</colorPalette>
        </format>
        <format type="color" field="app.apdex_score">
          <colorPalette type="list">[#D93F3C,#F7BC38,#65A637]</colorPalette>
          <scale type="threshold">0.75,0.9</scale>
        </format>
        <format type="color" field="eum.apdex_score">
          <colorPalette type="list">[#D93F3C,#F7BC38,#65A637]</colorPalette>
          <scale type="threshold">0.75,0.9</scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Average Application Server APDEX</title>
      <chart>
        <search>
          <query>sourcetype=newrelic_account source="key_transactions.json" account_id="$input_name$" 


| spath input=_raw output=all_apps path=key_transactions{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*


| search name="$key_txn$" reporting=true
| stats avg(app.apdex_score)</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.rangeValues">[0,0.75,0.9,1]</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.gaugeColors">["0xd13b3b","0xFFE800","0x84E900"]</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <title>Average End User APDEX</title>
      <chart>
        <search>
          <query>sourcetype=newrelic_account source="key_transactions.json" account_id="$input_name$" 

| spath input=_raw output=all_apps path=key_transactions{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*


| search name="$key_txn$" reporting=true
| stats avg(eum.apdex_score)</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.rangeValues">[0,0.75,0.9,1]</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.gaugeColors">["0xd13b3b","0xFFE800","0x84E900"]</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>AppServer Average Response Times</title>
      <chart>
        <search>
          <query>sourcetype=newrelic_account source="key_transactions.json" account_id="$input_name$" 


| spath input=_raw output=all_apps path=key_transactions{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*


| search name="$key_txn$" 
|timechart avg(app.response_time) as "App Response Time"| predict "App Response Time" future_timespan=20</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <title>AppServer Requests per Minute</title>
      <chart>
        <search>
          <query>sourcetype=newrelic_account source="key_transactions.json" account_id="$input_name$" 


| spath input=_raw output=all_apps path=key_transactions{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*


| search name="$key_txn$" 
|timechart avg(app.throughput) as "App Throughput"| predict "App Throughput" future_timespan=20</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <title>AppServer Error Rate</title>
      <chart>
        <search>
          <query>sourcetype=newrelic_account source="key_transactions.json" account_id="$input_name$" 


| spath input=_raw output=all_apps path=key_transactions{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*


| search name="$key_txn$" 
|timechart avg(app.error_rate) as "App Error Rate" | predict "App Error Rate" future_timespan=20</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
</form>