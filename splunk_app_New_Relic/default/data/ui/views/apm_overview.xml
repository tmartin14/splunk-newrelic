<form>
  <label>Web Applications</label>
  <description>Overview of the applications monitored by New Relic</description>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="myTime">
      <label>Time Period</label>
      <default>
        <earliest>-60m@m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="input_name" searchWhenChanged="true">
      <label>Account</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>account_id</fieldForLabel>
      <fieldForValue>account_id</fieldForValue>
      <search>
        <query>sourcetype=newrelic_account  |  dedup account_id | table  account_id</query>
      </search>
    </input>
    <input type="dropdown" token="web_app" searchWhenChanged="true">
      <label>Web Applications</label>
      <choice value="*">All</choice>
      <fieldForLabel>applications{}.name</fieldForLabel>
      <fieldForValue>applications{}.name</fieldForValue>
      <search>
        <query>sourcetype=newrelic_account source="applications.json" account_id="$input_name$"  | mvexpand applications{}.name | dedup applications{}.name | table applications{}.name</query>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </search>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <table>
        <title>Application Overview - Last Reported Values</title>
        <search>
          <query>sourcetype="newrelic_account" source="applications.json" account_id="$input_name$"    | spath input=_raw output=all_apps path=applications{} | mvexpand all_apps | spath input=all_apps | rename id as application_id application_summary.* as app.* end_user_summary.* as eum.* | dedup name | search name="$web_app$" | table account_id application_id name language reporting health_status app.apdex_score app.response_time app.throughput app.error_rate eum.apdex_score eum.response_time eum.throughput app.host_count app.instance_count last_reported_at</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="health_status">
          <colorPalette type="map">{"red":#D93F3C,"green":#65A637,"gray":#D3D3D3,"unknown":#555555,"orange":#ED8440}</colorPalette>
        </format>
        <format type="color" field="reporting">
          <colorPalette type="map">{"true":#65A637,"false":#D3D3D3}</colorPalette>
        </format>
        <format type="color" field="app.apdex_score">
          <colorPalette type="list">[#D93F3C,#F7BC38,#65A637]</colorPalette>
          <scale type="threshold">0.75,0.9</scale>
        </format>
        <format type="number" field="app.apdex_score"></format>
        <format type="number" field="app.throughput">
          <option name="unit">rpm</option>
        </format>
        <format type="number" field="eum.throughput">
          <option name="unit">rpm</option>
        </format>
        <format type="number" field="eum.apdex_score"></format>
        <format type="color" field="eum.apdex_score">
          <colorPalette type="list">[#D93F3C,#F7BC38,#65A637]</colorPalette>
          <scale type="threshold">0.75,0.9</scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Average Application Server APDEX</title>
      <chart>
        <search>
          <query>sourcetype="newrelic_account" source="applications.json" account_id="$input_name$" | spath input=_raw output=all_apps path=applications{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*
| dedup name

| search name="$web_app$"  reporting=true
| stats avg(app.apdex_score)</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.rangeValues">[0,0.75,0.9,1]</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.gaugeColors">["0xd13b3b","0xFFE800","0x84E900"]</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <title>Average End User APDEX</title>
      <chart>
        <search>
          <query>sourcetype="newrelic_account" source="applications.json" account_id="$input_name$" 
| spath input=_raw output=all_apps path=applications{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*
| dedup name

| search name="$web_app$" reporting=true
| stats avg(eum.apdex_score)</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.rangeValues">[0,0.75,0.9,1]</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.gaugeColors">["0xd13b3b","0xFFE800","0x84E900"]</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>AppServer Average Response Times</title>
      <chart>
        <search>
          <query>sourcetype="newrelic_account" source="applications.json" account_id="$input_name$" | spath input=_raw output=all_apps path=applications{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*



| search name="$web_app$" 
|timechart avg(app.response_time) as "App Response Time"| predict "App Response Time" future_timespan=20</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <title>AppServer Requests per Minute</title>
      <chart>
        <search>
          <query>sourcetype="newrelic_account" source="applications.json" account_id="$input_name$" | spath input=_raw output=all_apps path=applications{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*



| search name="$web_app$" 
|timechart avg(app.throughput) as "Requests per Minute"| predict "Requests per Minute" future_timespan=20</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <title>AppServer Error Rate</title>
      <chart>
        <search>
          <query>sourcetype="newrelic_account" source="applications.json" account_id="$input_name$" | spath input=_raw output=all_apps path=applications{} 
| mvexpand all_apps
| spath input=all_apps
| rename application_summary.* as app.* end_user_summary.* as eum.*



| search name="$web_app$" 
|timechart avg(app.error_rate) as "Error Rate"| predict "Error Rate" future_timespan=20</query>
          <earliest>$myTime.earliest$</earliest>
          <latest>$myTime.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
</form>